<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Data attach utilities — attach_src • ICU data with R</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Data attach utilities — attach_src" />
<meta property="og:description" content="Making a dataset available to ricu consists of 3 steps: downloading
(download_src()), importing (import_src()) and attaching
(attach_src()). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in .csv format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ricu.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss.pdf">\pkg{ricu}: \proglang{R}'s Interface to Intensive Care Data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/eth-mds/ricu">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Data attach utilities</h1>
    
    <div class="hidden name"><code>attach_src.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Making a dataset available to <code>ricu</code> consists of 3 steps: downloading
(<code><a href='download_src.html'>download_src()</a></code>), importing (<code><a href='import_src.html'>import_src()</a></code>) and attaching
(<code>attach_src()</code>). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in <code>.csv</code> format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package.</p>
    </div>

    <pre class="usage"><span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for src_cfg</span>
<span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, assign_env <span class='op'>=</span> <span class='cn'>NULL</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for character</span>
<span class='fu'>attach_src</span><span class='op'>(</span><span class='va'>x</span>, assign_env <span class='op'>=</span> <span class='cn'>NULL</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>detach_src</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>

<span class='fu'>setup_src_env</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for src_cfg</span>
<span class='fu'>setup_src_env</span><span class='op'>(</span><span class='va'>x</span>, data_dir <span class='op'>=</span> <span class='fu'><a href='data_dir.html'>src_data_dir</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, link_env <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Data source to attach</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Forwarded to further calls to <code>attach_src()</code></p></td>
    </tr>
    <tr>
      <th>assign_env, link_env</th>
      <td><p>Environment in which the data source will become
available</p></td>
    </tr>
    <tr>
      <th>data_dir</th>
      <td><p>Directory used to look for <code><a href='http://www.fstpackage.org/reference/fst.html'>fst::fst()</a></code> files; <code>NULL</code> calls
<code><a href='data_dir.html'>data_dir()</a></code> using the source name as <code>subdir</code> argument</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Both <code>attach_src()</code> and <code>setup_src_env()</code> are called for side
effects and therefore return invisibly. While <code>attach_src()</code> returns <code>NULL</code>,
<code>setup_src_env()</code> returns the newly created <code>src_env</code> object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Attaching a dataset sets up two types of S3 classes: a single <code>src_env</code>
object, containing as many <code>src_tbl</code> objects as tables are associated with
the dataset. A <code>src_env</code> is an environment with an <code>id_cfg</code> attribute, as
well as sub-classes as specified by the data source <code>class_prefix</code>
configuration setting (see <code><a href='load_src_cfg.html'>load_src_cfg()</a></code>). All <code>src_env</code> objects created
by calling <code>attach_src()</code> represent environments that are direct
descendants of the <code>data</code> environment and are bound to the respective
dataset name within that environment. For more information on <code>src_env</code> and
<code>src_tbl</code> objects, refer to <code><a href='new_src_tbl.html'>new_src_tbl()</a></code>.</p>
<p>If set up correctly, it is not necessary for the user to directly call
<code>attach_src()</code>. When the package is loaded, the default data sources (see
<code><a href='data_dir.html'>auto_attach_srcs()</a></code>) are attached automatically. This default can be
controlled by setting as environment variable <code>RICU_SRC_LOAD</code> a comma
separated list of data source names before loading the library. Setting
this environment variable as</p><pre><span class='fu'><a href='https://rdrr.io/r/base/Sys.setenv.html'>Sys.setenv</a></span><span class='op'>(</span>RICU_SRC_LOAD <span class='op'>=</span> <span class='st'>"mimic_demo,eciu_demo"</span><span class='op'>)</span>
</pre>

<p>will change the default of loading both MIMIC-III and eICU, alongside the
respective demo datasets, as well as HiRID and AUMC, to just the two demo
datasets. For setting an environment variable upon startup of the R
session, refer to <code><a href='https://rdrr.io/r/base/Startup.html'>base::.First.sys()</a></code>.</p>
<p>Attaching a dataset during package namespace loading will both instantiate
a corresponding <code>src_env</code> in the <code>data</code> environment and for convenience
also assign this object into the package namespace, such that for example
the MIMIC-III demo dataset not only is available as
<code>ricu::data::mimic_demo</code>, but also as <code><a href='data.html'>ricu::mimic_demo</a></code> (or if the package
namespace is attached, simply as <code>mimic_demo</code>). Dataset attaching using
<code>attach_src()</code> does not need to happen during namespace loading, but can be
triggered by the user at any time. If such a convenience link as described
above is desired by the user, an environment such as <code>.GlobalEnv</code> has to be
passed as <code>assign_env</code> to <code>attach_src()</code>.</p>
<p>Data sets are set up as <code>src_env</code> objects irrespectively of whether all (or
any) of the required data is available. If some (or all) data is missing,
the user is asked for permission to download in interactive sessions and an
error is thrown in non-interactive sessions. Downloading demo datasets
requires no further information but access to full-scale datasets (even
though they are publicly available) is guarded by access credentials (see
<code><a href='download_src.html'>download_src()</a></code>).</p>
<p>While <code>attach_src()</code> provides the main entry point, <code>src_env</code> objects are
instantiated by the S3 generic function <code>setup_src_env()</code> and the wrapping
function serves to catch errors that might be caused by config file parsing
issues as to not break attaching of the package namespace. Apart form this,
<code>attach_src()</code> also provides the convenience linking into the package
namespace (or a user-specified environment) described above.</p>
<p>A <code>src_env</code> object created by <code>setup_src_env()</code> does not directly contain
<code>src_tbl</code> objects bound to names, but rather an active binding (see
<code><a href='https://rdrr.io/r/base/bindenv.html'>base::makeActiveBinding()</a></code>) per table. These active bindings check for
availability of required files and evaluate to corresponding <code>src_tbl</code>
objects if these checks are passed and ask for user input otherwise. As
<code>src_tbl</code> objects are intended to be read-only, assignment is not possible
except for the value <code>NULL</code> which resets the internally cached <code>src_tbl</code>
that is created on first successful access.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='fu'><a href='https://rdrr.io/r/base/Sys.setenv.html'>Sys.setenv</a></span><span class='op'>(</span>RICU_SRC_LOAD <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/eth-mds/ricu'>ricu</a></span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span>envir <span class='op'>=</span> <span class='va'>data</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>

<span class='fu'>attach_src</span><span class='op'>(</span><span class='st'>"mimic_demo"</span>, assign_env <span class='op'>=</span> <span class='va'>.GlobalEnv</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span>envir <span class='op'>=</span> <span class='va'>data</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>

<span class='va'>mimic_demo</span>

<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



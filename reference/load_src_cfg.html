<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Load configuration for a data source — load_src_cfg • ICU data with R</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Load configuration for a data source — load_src_cfg" />
<meta property="og:description" content="For a data source to be accessible by ricu, a configuration object
inheriting from the S3 class src_cfg is required. Such objects can be
generated from JSON based configuration files, using load_src_cfg().
Information encoded by this configuration object includes available ID
systems (mainly for use in change_id(), default column names per table
for columns with special meaning (such as index column, value columns, unit
columns, etc.), as well as a specification used for initial setup of the
dataset which includes file names and column names alongside their data
types." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ricu.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss.pdf">ricu: R's Interface to Intensive Care Data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/eth-mds/ricu">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Load configuration for a data source</h1>
    
    <div class="hidden name"><code>load_src_cfg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For a data source to be accessible by <code>ricu</code>, a configuration object
inheriting from the S3 class <code>src_cfg</code> is required. Such objects can be
generated from JSON based configuration files, using <code>load_src_cfg()</code>.
Information encoded by this configuration object includes available ID
systems (mainly for use in <code><a href='change_id.html'>change_id()</a></code>, default column names per table
for columns with special meaning (such as index column, value columns, unit
columns, etc.), as well as a specification used for initial setup of the
dataset which includes file names and column names alongside their data
types.</p>
    </div>

    <pre class="usage"><span class='fu'>load_src_cfg</span><span class='op'>(</span>src <span class='op'>=</span> <span class='cn'>NULL</span>, name <span class='op'>=</span> <span class='st'>"data-sources"</span>, cfg_dirs <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>src</th>
      <td><p>(Optional) name(s) of data sources used for subsetting</p></td>
    </tr>
    <tr>
      <th>name</th>
      <td><p>String valued name of a config file which will be looked up in
the default config directors</p></td>
    </tr>
    <tr>
      <th>cfg_dirs</th>
      <td><p>Additional directory/ies to look for configuration files</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of data source configurations as <code>src_cfg</code> objects.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Configuration files are looked for as files <code>name</code> with added suffix
<code>.json</code> starting with the directory (or directories) supplied as <code>cfg_dirs</code>
argument, followed by the directory specified by the environment variable
<code>RICU_CONFIG_PATH</code>, and finally in <code>extdata/config</code> of the package install
directory. If files with matching names are found in multiple places they
are concatenated such that in cases of name clashes. the earlier hits take
precedent over the later ones. The following JSON code blocks show excerpts
of the config file available at</p><pre><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"config"</span>, <span class='st'>"data-sources.json"</span>, package <span class='op'>=</span> <span class='st'>"ricu"</span><span class='op'>)</span>
</pre>

<p>A data source configuration entry in a config file starts with a name,
followed by optional entries <code>class_prefix</code> and further (variable)
key-value pairs, such as an URL. For more information on <code>class_prefix</code>,
please refer to the end of this section. Further entries include <code>id_cfg</code>
and <code>tables</code> which are explained in more detail below. As outline, this
gives for the data source <code>mimic_demo</code>, the following JSON object:</p><pre>{
  "name": "mimic_demo",
  "class_prefix": ["mimic_demo", "mimic"],
  "url": "https://physionet.org/files/mimiciii-demo/1.4",
  "id_cfg": {
    ...
  },
  "tables": {
    ...
  }
}
</pre>

<p>The <code>id_cfg</code> entry is used to specify the available ID systems for a data
source and how they relate to each other. An ID system within the context
of <code>ricu</code> is a patient identifier of which typically several are present in
a data set. In MIMIC-III, for example, three ID systems are available:
patient IDs (<code>subject_id</code>), hospital admission IDs (<code>hadm_id</code>) and ICU stay
IDs (<code>icustay_id</code>). Furthermore there is a one-to-many relationship between
<code>subject_id</code> and <code>hadm_id</code>, as well as between <code>hadm_id</code> and <code>icustay_id</code>.
Required for defining an ID system are a name, a <code>position</code> entry which
orders the ID systems by their cardinality, a <code>table</code> entry, alongside
column specifications <code>id</code>, <code>start</code> and <code>end</code>, which define how the IDs
themselves, combined with start and end times can be loaded from a table.
This gives the following specification for the ICU stay ID system in
MIMIC-III:</p><pre>{
  "icustay": {
    "id": "icustay_id",
    "position": 3,
    "start": "intime",
    "end": "outtime",
    "table": "icustays"
  }
}
</pre>

<p>Tables are defined by a name and entries <code>files</code>, <code>defaults</code>, and <code>cols</code>,
as well as optional entries <code>num_rows</code> and <code>partitioning</code>. As <code>files</code> entry,
a character vector of file names is expected. For all of MIMIC-III a single
<code>.csv</code> file corresponds to a table, but for example for HiRID, some tables
are distributed in partitions. The <code>defaults</code> entry consists of key-value
pairs, identifying columns in a table with special meaning, such as the
default index column or the set of all columns that represent timestamps.
This gives as an example for a table entry for the <code>chartevents</code> table in
MIMIC-III a JSON object like:</p><pre>{
  "chartevents": {
    "files": "CHARTEVENTS.csv.gz",
    "defaults": {
      "index_var": "charttime",
      "val_var": "valuenum",
      "unit_var": "valueuom",
      "time_vars": ["charttime", "storetime"]
    },
    "num_rows": 330712483,
    "cols": {
      ...
    },
    "partitioning": {
      "col": "itemid",
      "breaks": [127, 210, 425, 549, 643, 741, 1483, 3458, 3695, 8440,
                 8553, 220274, 223921, 224085, 224859, 227629]
    }
  }
}
</pre>

<p>The optional <code>num_rows</code> entry is used when importing data (see
<code><a href='import_src.html'>import_src()</a></code>) as a sanity check, which is not performed if this entry is
missing from the data source configuration. The remaining table entry,
<code>partitioning</code>, is optional in the sense that if it is missing, the table
is not partitioned and if it is present, the table will be partitioned
accordingly when being imported (see <code><a href='import_src.html'>import_src()</a></code>). In order to specify a
partitioning, two entries are required, <code>col</code> and <code>breaks</code>, where the former
denotes a column and the latter a numeric vector which is used to construct
intervals according to which <code>col</code> is binned. As such, currently <code>col</code> is
required to be of numeric type. A <code>partitioning</code> entry as in the example
above will assign rows corresponding to <code>idemid</code> 1 through 126 to partition
1, 127 through 209 to partition 2 and so on up to partition 17.</p>
<p>Column specifications consist of a <code>name</code> and a <code>spec</code> entry alongside a
name which determines the column name that will be used by <code>ricu</code>. The
<code>spec</code> entry is expected to be the name of a column specification function
of the <code>readr</code> package (see <code><a href='https://readr.tidyverse.org/reference/cols.html'>readr::cols()</a></code>) and all further entries in a
<code>cols</code> object are used as arguments to the <code>readr</code> column specification.
For the <code>admissions</code> table of MIMIC-III the columns <code>hadm_id</code> and
<code>admittime</code> are represented by:</p><pre>{
  ...,
  "hadm_id": {
    "name": "HADM_ID",
    "spec": "col_integer"
  },
  "admittime": {
    "name": "ADMITTIME",
    "spec": "col_datetime",
    "format": "%Y-%m-%d %H:%M:%S"
  },
  ...
}
</pre>

<p>Internally, a <code>src_cfg</code> object consist of further S3 classes, which are
instantiated when loading a JSON source configuration file. Functions for
creating and manipulating <code>src_cfg</code> and related objects are marked
<code>internal</code> but a brief overview is given here nevertheless:</p><ul>
<li><p><code>src_cfg</code>: wraps objects <code>id_cfg</code>, <code>col_cfg</code> and optionally <code>tbl_cfg</code></p></li>
<li><p><code>id_cfg</code>: contains information in ID systems and is created from <code>id_cfg</code>
entries in config files</p></li>
<li><p><code>col_cfg</code>: contains column default settings represented by <code>defaults</code>
entries in table configuration blocks</p></li>
<li><p><code>tbl_cfg</code>: used when importing data and therefore encompasses information
in <code>files</code>, <code>num_rows</code> and <code>cols</code> entries of table configuration blocks</p></li>
</ul>

<p>A <code>src_cfg</code> can be instantiated without corresponding <code>tbl_cfg</code> but
consequently cannot be used for data import (see <code><a href='import_src.html'>import_src()</a></code>). In that
sense, table config entries <code>files</code> and <code>cols</code> are optional as well with
the restriction that the data source has to be already available in <code>.fst</code>
format</p>
<p>An example for such a slimmed down config file is available at</p><pre><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"config"</span>, <span class='st'>"demo-sources.json"</span>, package <span class='op'>=</span> <span class='st'>"ricu"</span><span class='op'>)</span>
</pre>

<p>The <code>class_prefix</code> entry in a data source configuration is used create sub-
classes to <code>src_cfg</code>, <code>id_cfg</code>, <code>col_cfg</code> and <code>tbl_cfg</code> classes and passed
on to constructors of <code>src_env</code> (<code><a href='new_src_tbl.html'>new_src_env()</a></code>) and <code>src_tbl</code>
<code><a href='new_src_tbl.html'>new_src_tbl()</a></code> objects. As an example, for the above <code>class_prefix</code> value
of <code><a href='https://rdrr.io/r/base/c.html'>c("mimic_demo", "mimic")</a></code>, the corresponding <code>src_cfg</code> will be assigned
classes <code><a href='https://rdrr.io/r/base/c.html'>c("mimic_demo_cfg", "mimic_cfg", "src_cfg")</a></code> and consequently the
<code>src_tbl</code> objects will inherit from <code>"mimic_demo_tbl"</code>, <code>"mimic_tbl"</code> and
<code> "src_tbl"</code>. This can be used to adapt the behavior of involved S3 generic
function to specifics of the different data sources. An example for this is
how <code><a href='load_src.html'>load_difftime()</a></code> uses theses sub-classes to smoothen out different
time-stamp representations. Furthermore, such a design was chosen with
extensibility in mind. Currently, <code><a href='download_src.html'>download_src()</a></code> is designed around data
sources hosted on PhysioNet, but in order to include a dataset external to
PhysioNet, the <code><a href='download_src.html'>download_src()</a></code> generic can simply be extended for the new
class.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>cfg</span> <span class='op'>&lt;-</span> <span class='fu'>load_src_cfg</span><span class='op'>(</span><span class='st'>"mimic_demo"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>cfg</span>, max.level <span class='op'>=</span> <span class='fl'>1L</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 1
#&gt;  $ mimic_demo:List of 6
#&gt;   ..- attr(*, "class")= chr [1:3] "mimic_demo_cfg" "mimic_cfg" "src_cfg"</div><div class='input'><span class='va'>cfg</span> <span class='op'>&lt;-</span> <span class='va'>cfg</span><span class='op'>[[</span><span class='st'>"mimic_demo"</span><span class='op'>]</span><span class='op'>]</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>cfg</span>, max.level <span class='op'>=</span> <span class='fl'>1L</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 6
#&gt;  $ name   : chr "mimic_demo"
#&gt;  $ prefix : chr [1:2] "mimic_demo" "mimic"
#&gt;  $ id_cfg : id_cfg [1:3] `subject_id`, `hadm_id`, `icustay_id`
#&gt;  $ col_cfg: col_cfg [1:25] [0, 0, 5, 0, 1], [0, 1, 6, 0, 1], [1, 0, 0, 0, 1], [0, ...
#&gt;  $ tbl_cfg: tbl_cfg [1:25] [?? ✖ 19; 1], [?? ✖ 24; 1], [?? ✖ 4; 1], [?? ✖ 15; 2], ...
#&gt;  $ extra  :List of 1
#&gt;  - attr(*, "class")= chr [1:3] "mimic_demo_cfg" "mimic_cfg" "src_cfg"</div><div class='input'>
<span class='va'>cols</span> <span class='op'>&lt;-</span> <span class='fu'><a href='new_src_cfg.html'>as_col_cfg</a></span><span class='op'>(</span><span class='va'>cfg</span><span class='op'>)</span>
<span class='fu'><a href='id_vars.html'>index_var</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>cols</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $admissions
#&gt; NULL
#&gt; 
#&gt; $callout
#&gt; [1] "outcometime"
#&gt; 
#&gt; $caregivers
#&gt; NULL
#&gt; 
#&gt; $chartevents
#&gt; [1] "charttime"
#&gt; 
#&gt; $cptevents
#&gt; [1] "chartdate"
#&gt; 
#&gt; $d_cpt
#&gt; NULL
#&gt; </div><div class='input'><span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>cols</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; $admissions
#&gt; [1] "admittime" "dischtime" "deathtime" "edregtime" "edouttime"
#&gt; 
#&gt; $callout
#&gt; [1] "createtime"             "updatetime"             "acknowledgetime"       
#&gt; [4] "outcometime"            "firstreservationtime"   "currentreservationtime"
#&gt; 
#&gt; $caregivers
#&gt; NULL
#&gt; 
#&gt; $chartevents
#&gt; [1] "charttime" "storetime"
#&gt; 
#&gt; $cptevents
#&gt; [1] "chartdate"
#&gt; 
#&gt; $d_cpt
#&gt; NULL
#&gt; </div><div class='input'>
<span class='fu'><a href='new_src_cfg.html'>as_id_cfg</a></span><span class='op'>(</span><span class='va'>cfg</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;id_cfg&lt;mimic_demo[patient &lt; hadm &lt; icustay]&gt;[3]&gt;
#&gt;      patient         hadm      icustay 
#&gt; `subject_id`    `hadm_id` `icustay_id` </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



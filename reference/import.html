<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Data import utilities — import_src • ICU data with R</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Data import utilities — import_src"><meta property="og:description" content="Making a dataset available to ricu consists of 3 steps: downloading
(download_src()), importing (import_src()) and attaching
(attach_src()). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in .csv format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/ricu.pdf">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/start.html">Quick start guide</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/eth-mds/ricu" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Data import utilities</h1>
    
    <div class="hidden name"><code>import.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Making a dataset available to <code>ricu</code> consists of 3 steps: downloading
(<code><a href="download.html">download_src()</a></code>), importing (<code>import_src()</code>) and attaching
(<code><a href="attach_src.html">attach_src()</a></code>). While downloading and importing are one-time procedures,
attaching of the dataset is repeated every time the package is loaded.
Briefly, downloading loads the raw dataset from the internet (most likely
in <code>.csv</code> format), importing consists of some preprocessing to make the
data available more efficiently and attaching sets up the data for use by
the package.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">import_src</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for src_cfg</span></span>
<span><span class="fu">import_src</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="file_utils.html">src_data_dir</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  tables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for aumc_cfg</span></span>
<span><span class="fu">import_src</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for character</span></span>
<span><span class="fu">import_src</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="file_utils.html">src_data_dir</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  tables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  force <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  cleanup <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">import_tbl</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for tbl_cfg</span></span>
<span><span class="fu">import_tbl</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="file_utils.html">src_data_dir</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cleanup <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>Object specifying the source configuration</p></dd>


<dt>...</dt>
<dd><p>Passed to downstream methods (finally to
<a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">readr::read_csv</a>/<a href="https://readr.tidyverse.org/reference/read_delim_chunked.html" class="external-link">readr::read_csv_chunked</a>)/generic consistency</p></dd>


<dt>data_dir</dt>
<dd><p>Destination directory where the downloaded data is written
to.</p></dd>


<dt>tables</dt>
<dd><p>Character vector specifying the tables to download. If
<code>NULL</code>, all available tables are downloaded.</p></dd>


<dt>force</dt>
<dd><p>Logical flag; if <code>TRUE</code>, existing data will be re-downloaded</p></dd>


<dt>verbose</dt>
<dd><p>Logical flag indicating whether to print progress information</p></dd>


<dt>cleanup</dt>
<dd><p>Logical flag indicating whether to remove raw csv files after
conversion to fst</p></dd>


<dt>progress</dt>
<dd><p>Either <code>NULL</code> or a progress bar as created by
<code><a href="https://rdrr.io/pkg/progress/man/progress_bar.html" class="external-link">progress::progress_bar()</a></code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Called for side effects and returns <code>NULL</code> invisibly.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>In order to speed up data access operations, <code>ricu</code> does not directly use
the PhysioNet provided CSV files, but converts all data to <code><a href="http://www.fstpackage.org/reference/fst.html" class="external-link">fst::fst()</a></code>
format, which allows for random row and column access. Large tables are
split into chunks in order to keep memory requirements reasonably low.</p>
<p>The one-time step per dataset of data import is fairly resource intensive:
depending on CPU and available storage system, it will take on the order of
an hour to run to completion and depending on the dataset, somewhere
between 50 GB and 75 GB of temporary disk space are required as tables are
uncompressed, in case of partitioned data, rows are reordered and the data
again is saved to a storage efficient format.</p>
<p>The S3 generic function <code>import_src()</code> performs import of an entire data
source, internally calling the S3 generic function <code>import_tbl()</code> in order
to perform import of individual tables. Method dispatch is intended to
occur on objects inheriting from <code>src_cfg</code> and <code>tbl_cfg</code> respectively. Such
objects can be generated from JSON based configuration files which contain
information such as table names,  column types or row numbers, in order to
provide safety in parsing of <code>.csv</code> files. For more information on data
source configuration, refer to <code><a href="load_src_cfg.html">load_src_cfg()</a></code>.</p>
<p>Current import capabilities include re-saving a <code>.csv</code> file to <code>.fst</code> at
once (used for smaller sized tables), reading a large <code>.csv</code> file using the
<code><a href="https://readr.tidyverse.org/reference/read_delim_chunked.html" class="external-link">readr::read_csv_chunked()</a></code> API, while partitioning chunks and reassembling
sub-partitions (used for splitting a large file into partitions), as well
as re-partitioning an already partitioned table according to a new
partitioning scheme. Care has been taken to keep the maximal memory
requirements for this reasonably low, such that data import is feasible on
laptop class hardware.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="download.html">download_src</a></span><span class="op">(</span><span class="st">"mimic_demo"</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">import_src</span><span class="op">(</span><span class="st">"mimic_demo"</span>, <span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>


<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Switch between id types — change_id • ICU data with R</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Switch between id types — change_id" />
<meta property="og:description" content="ICU datasets such as MIMIC-III or eICU typically represent patients by
multiple ID systems such as patient IDs, hospital stay IDs and ICU
admission IDs. Even if the raw data is available in only one such ID
system, given a mapping of IDs alongside start and end times, it is
possible to convert data from one ID system to another. The function
change_id() provides such a conversion utility, internally either
calling upgrade_id() when moving to an ID system with higher cardinality
and downgrade_id() when the target ID system is of lower cardinality" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ricu.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jss.pdf">ricu: R's Interface to Intensive Care Data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/eth-mds/ricu">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Switch between id types</h1>
    
    <div class="hidden name"><code>change_id.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>ICU datasets such as MIMIC-III or eICU typically represent patients by
multiple ID systems such as patient IDs, hospital stay IDs and ICU
admission IDs. Even if the raw data is available in only one such ID
system, given a mapping of IDs alongside start and end times, it is
possible to convert data from one ID system to another. The function
<code>change_id()</code> provides such a conversion utility, internally either
calling <code>upgrade_id()</code> when moving to an ID system with higher cardinality
and <code>downgrade_id()</code> when the target ID system is of lower cardinality</p>
    </div>

    <pre class="usage"><span class='fu'>change_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, <span class='va'>...</span>, keep_old_id <span class='op'>=</span> <span class='cn'>TRUE</span>, id_type <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='fu'>upgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>downgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for ts_tbl</span>
<span class='fu'>upgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for id_tbl</span>
<span class='fu'>upgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for ts_tbl</span>
<span class='fu'>downgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for id_tbl</span>
<span class='fu'>downgrade_id</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>target_id</span>, <span class='va'>src</span>, cols <span class='op'>=</span> <span class='fu'><a href='id_vars.html'>time_vars</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>icu_tbl</code> object for which to make the id change</p></td>
    </tr>
    <tr>
      <th>target_id</th>
      <td><p>The destination id name</p></td>
    </tr>
    <tr>
      <th>src</th>
      <td><p>Passed to <code><a href='new_src_cfg.html'>as_id_cfg()</a></code> and <code><a href='new_src_tbl.html'>as_src_env()</a></code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Passed to <code>upgrade_id()</code>/<code>downgrade_id()</code></p></td>
    </tr>
    <tr>
      <th>keep_old_id</th>
      <td><p>Logical flag indicating whether to keep the previous ID
column</p></td>
    </tr>
    <tr>
      <th>id_type</th>
      <td><p>Logical flag indicating whether <code>target_id</code> is specified as
ID name (e.g. <code>icustay_id</code> on MIMIC) or ID type (e.g. <code>icustay</code>)</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Column names that require time-adjustment</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of the same type as <code>x</code> with modified IDs.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>In order to provide ID system conversion for a data source, the (internal)
function <code><a href='id_origin.html'>id_map()</a></code> must be able to construct an ID mapping for that data
source. Constructing such a mapping can be expensive w.r.t. the frequency
it might be re-used and therefore, <code><a href='id_origin.html'>id_map()</a></code> provides caching
infrastructure. The mapping itself is constructed by the (internal)
function <code><a href='id_origin.html'>id_map_helper()</a></code>, which is expected to provide source and
destination ID columns as well as start and end columns corresponding to
the destination ID, relative to the source ID system. In the following
example, we request for <code>mimic_demo</code>, with ICU stay IDs as source and
hospital admissions as destination IDs.<div class="r"></p><pre><span class='fu'><a href='id_origin.html'>id_map_helper</a></span><span class='op'>(</span><span class='va'>mimic_demo</span>, <span class='st'>"icustay_id"</span>, <span class='st'>"hadm_id"</span><span class='op'>)</span>
</pre><p></div></p><pre><span class='co'>## # An `id_tbl`: 136 x 4</span>
<span class='co'>## # Id var:      `icustay_id`</span>
<span class='co'>##     icustay_id hadm_id hadm_id_start hadm_id_end</span>
<span class='co'>##          &lt;int&gt;   &lt;int&gt; &lt;drtn&gt;        &lt;drtn&gt;</span>
<span class='co'>##   1     201006  198503  -3290 mins    9114 mins</span>
<span class='co'>##   2     201204  114648     -2 mins    6949 mins</span>
<span class='co'>##   3     203766  126949  -1336 mins    8818 mins</span>
<span class='co'>##   4     204132  157609     -1 mins   10103 mins</span>
<span class='co'>##   5     204201  177678   -368 mins    9445 mins</span>
<span class='co'>## ...</span>
<span class='co'>## 132     295043  170883 -10413 mins   31258 mins</span>
<span class='co'>## 133     295741  176805     -1 mins    3153 mins</span>
<span class='co'>## 134     296804  110244  -1294 mins    4599 mins</span>
<span class='co'>## 135     297782  167612     -1 mins     207 mins</span>
<span class='co'>## 136     298685  151323     -1 mins   19082 mins</span>
<span class='co'>## # ... with 126 more rows</span>
</pre>

<p>Both start and end columns encode the hospital admission windows relative
to each corresponding ICU stay start time. It therefore comes as no
surprise that most start times are negative (hospital admission typically
occurs before ICU stay start time), while end times are often days in the
future (as hospital discharge typically occurs several days after ICU
admission).</p>
<p>In order to use the ID conversion infrastructure offered by <code>ricu</code> for a
new dataset, it typically suffices to provide an <code>id_cfg</code> entry in the
source configuration (see <code><a href='load_src_cfg.html'>load_src_cfg()</a></code>), outlining the available ID
systems alongside an ordering, as well as potentially a class specific
implementation of <code><a href='id_origin.html'>id_map_helper()</a></code> for the given source class, specifying
the corresponding time windows in 1 minute resolution (for every possible
pair of IDs).</p>
<p>While both up- and downgrades for <code>id_tbl</code> objects, as well as downgrades
for <code>ts_tbl</code> objects are simple merge operations based on the ID mapping
provided by <code><a href='id_origin.html'>id_map()</a></code>, ID upgrades for <code>ts_tbl</code> objects are slightly more
involved. As an example, consider the following setting: we have <code>data</code>
associated with <code>hadm_id</code> IDs and times relative to hospital admission:</p><pre>               1      2       3        4       5       6        7      8
data        ---*------*-------*--------*-------*-------*--------*------*---
               3h    10h     18h      27h     35h     43h      52h    59h

                                         HADM_1
            0h     7h                26h        37h             53h      62h
hadm_id     |-------------------------------------------------------------|
icustay_id         |------------------|          |---------------|
                   0h                19h         0h             16h
                           ICU_1                       ICU_2
</pre>

<p>The mapping of data points from <code>hadm_id</code> to <code>icustay_id</code> is created as
follows: ICU stay end times mark boundaries and all data that is recorded
after the last ICU stay ended is assigned to the last ICU stay. Therefore
data points 1-3 are assigned to <code>ICU_1</code>, while 4-8 are assigned to <code>ICU_2</code>.
Times have to be shifted as well, as timestamps are expected to be relative
to the current ID system. Data points 1-3 therefore are assigned to time
stamps -4h, 3h and 11h, while data points 4-8 are assigned to -10h, -2h,
6h, 15h and 22h. Implementation-wise, the mapping is computed using an
efficient <code>data.table</code> rolling join.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://physionet.org/content/mimiciii-demo/1.4'>mimic.demo</a></span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>tbl</span> <span class='op'>&lt;-</span> <span class='va'>mimic_demo</span><span class='op'>$</span><span class='va'>labevents</span>
<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_src.html'>load_difftime</a></span><span class='op'>(</span><span class='va'>tbl</span>, <span class='va'>itemid</span> <span class='op'>==</span> <span class='fl'>50809</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"charttime"</span>, <span class='st'>"valuenum"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>dat</span>

<span class='fu'>change_id</span><span class='op'>(</span><span class='va'>dat</span>, <span class='st'>"icustay_id"</span>, <span class='va'>tbl</span>, keep_old_id <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='op'>}</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: mimic.demo</span></div><div class='output co'>#&gt; <span style='color: #949494;'># An `id_tbl`: 284 ✖ 3</span>
#&gt; <span style='color: #949494;'># Id var:      `icustay_id`</span>
#&gt;     icustay_id charttime  valuenum
#&gt;          <span style='color: #949494; font-style: italic;'>&lt;int&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;drtn&gt;</span>        <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt;   <span style='color: #949494;'>1</span>     <span style='text-decoration: underline;'>201</span>006   689 mins      129
#&gt;   <span style='color: #949494;'>2</span>     <span style='text-decoration: underline;'>201</span>006   877 mins      144
#&gt;   <span style='color: #949494;'>3</span>     <span style='text-decoration: underline;'>203</span>766   726 mins      164
#&gt;   <span style='color: #949494;'>4</span>     <span style='text-decoration: underline;'>203</span>766   766 mins      185
#&gt;   <span style='color: #949494;'>5</span>     <span style='text-decoration: underline;'>203</span>766   833 mins      181
#&gt;   <span style='color: #949494;'>…</span>
#&gt; <span style='color: #949494;'>280</span>     <span style='text-decoration: underline;'>295</span>043 13746 mins      156
#&gt; <span style='color: #949494;'>281</span>     <span style='text-decoration: underline;'>295</span>741  -125 mins      122
#&gt; <span style='color: #949494;'>282</span>     <span style='text-decoration: underline;'>296</span>804   638 mins      105
#&gt; <span style='color: #949494;'>283</span>     <span style='text-decoration: underline;'>298</span>685  4472 mins       88
#&gt; <span style='color: #949494;'>284</span>     <span style='text-decoration: underline;'>298</span>685 13861 mins      138
#&gt; <span style='color: #949494;'># … with 274 more rows</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



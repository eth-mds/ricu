<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Units of measurement • ICU data with R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Units of measurement">
<meta property="og:description" content="ricu">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ricu.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jss.pdf">\pkg{ricu}: \proglang{R}'s Interface to Intensive Care Data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eth-mds/ricu">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="uom_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Units of measurement</h1>
            
      
      
      <div class="hidden name"><code>uom.Rmd</code></div>

    </div>

    
    
<p>One challenge when working with electronic healthcare (EHR) data from different hospitals, which is accentuated if the intensive care units (ICUs) collecting the data are located in different geographic regions, is the use of different measurement unit systems. In part, this can be attributed to the use of imperial units in English speaking countries (e.g. patient weight being reported in lbs instead of kg), but more subtle differences in practice are involved as well, such as reporting lab test results in mg/dL instead of the SI unit mmol/L. While discrepancies of the former type are easy to resolve, harmonization of different notions of concentration is slightly more involved due to the conversion factor being substance-specific.</p>
<div id="ricu-data-concepts" class="section level2">
<h2 class="hasAnchor">
<a href="#ricu-data-concepts" class="anchor"></a><code>ricu</code> data concepts</h2>
<p>Data concepts of type <code>num_cncpt</code> can specify an expected units as character vector (where the string in position 1 is added as per-column attribute <code>units</code>). Due to the complexity involved, unit conversion to the specified target unit currently is not handled automatically<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Instead, item-specific callback functions are responsible for handling this, while unit mismatches are reported as messages during concept loading.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_concepts.html">load_concepts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lact"</span>, <span class="st">"map"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mimic_demo"</span>, <span class="st">"eicu_demo"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ── Loading 2 concepts ──────────────────────────────────────────────────────────</span>
<span class="co">#&gt; • lact</span>
<span class="co">#&gt;   ◯ removed 19 (0.74%) of rows due to out of range (or `NA`) entries</span>
<span class="co">#&gt;   ◯ not all units are in [mmol/L]: mEq/L, mmole/L, MMOLL (0.62%, 0.08%,</span>
<span class="co">#&gt;     and 0.51%)</span>
<span class="co">#&gt; • map</span>
<span class="co">#&gt;   ◯ removed 1438014 (74.7%) of rows due to out of range (or `NA`)</span>
<span class="co">#&gt;     entries</span>
<span class="co">#&gt;   ◯ not all units are in [mmHg], [mm Hg]: NA (96.74%)</span>
<span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; # A `ts_tbl`: 139,144 ✖ 5</span>
<span class="co">#&gt; # Id vars:    `source`, `icustay_id`</span>
<span class="co">#&gt; # Units:      `lact` [mmol/L], `map` [mmHg]</span>
<span class="co">#&gt; # Index var:  `charttime` (1 hours)</span>
<span class="co">#&gt;         source     icustay_id charttime  lact   map</span>
<span class="co">#&gt;         &lt;chr&gt;           &lt;int&gt; &lt;drtn&gt;    &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;       1 eicu_demo      141764   1 hours    NA  112.</span>
<span class="co">#&gt;       2 eicu_demo      141764   2 hours    NA  128</span>
<span class="co">#&gt;       3 eicu_demo      141764   3 hours    NA  143</span>
<span class="co">#&gt;       4 eicu_demo      141764   4 hours    NA  133</span>
<span class="co">#&gt;       5 eicu_demo      141764   5 hours    NA  103</span>
<span class="co">#&gt;       …</span>
<span class="co">#&gt; 139,140 mimic_demo     298685 314 hours    NA   76</span>
<span class="co">#&gt; 139,141 mimic_demo     298685 315 hours    NA   58</span>
<span class="co">#&gt; 139,142 mimic_demo     298685 316 hours    NA   47</span>
<span class="co">#&gt; 139,143 mimic_demo     298685 317 hours    NA   35</span>
<span class="co">#&gt; 139,144 mimic_demo     298685 318 hours    NA   12</span>
<span class="co">#&gt; # … with 139,134 more rows</span></code></pre></div>
<p>Messages raised during loading of lactate values, for example, indicate that 0.62% of retrieved values are specified in mEq/L instead of mmol/L (which requires an identity transformation for unit conversion), while the remaining discrepancies are false positives (both mmole/L and MMOLL can be assumed to mean mmol/L). For mean arterial bloop pressure values, the target unit is specified as mmHg (with the alternative spelling mm Hg being accepted as well), however, due to the data organization in eICU<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, no explicit measurement units are specified for this variable, in turn causing the large percentage of missing unit values reported.</p>
<p>Several utility functions are exported from <code>ricu</code> for helping with creating callback functions that handle unit conversion. Data items corresponding to the bilirubin concept for the European datasets HiRID and AUMCdb, for example, have a callback entry specified as <code>convert_unit(binary_op(``*``, 0.058467), "mg/dL")</code>. This creates a callback functions which applies <code>binary_op(``*``, 0.058467)</code> to the column specified as <code>val_var</code> and replaces existing values in the column identified by <code>unit_var</code> with the value <code>"mg/dl"</code>. In case the loaded data already is comprised of a mix of units, a regular expression passed as <code>rgx</code> can be specified, which will be used to identify the rows on which to operate. Finally, the function <code>binary_op</code> turns a binary function into an unary function by fixing the second operand.</p>
<p>As a sanity check to see whether measurement units (and data values in general) are aligned when compared across datasets, density plots may be employed.</p>
<p><img src="uom_files/figure-html/unnamed-chunk-4-1.png" width="576"><img src="uom_files/figure-html/unnamed-chunk-4-2.png" width="576"><img src="uom_files/figure-html/unnamed-chunk-4-3.png" width="576"><img src="uom_files/figure-html/unnamed-chunk-4-4.png" width="576"><img src="uom_files/figure-html/unnamed-chunk-4-5.png" width="576"></p>
<p>When extending the <code>ricu</code> dictionary to both new data sources and new data concepts, it might be worthwhile to visually inspect the returned data in a fashion similar to the above in order to have a high-level confirmation that measurement units roughly agree.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Support for automatically handling this, using the <a href="https://cran.r-project.org/package=units">units</a> packages, is being considered, but so far has not been implemented<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Both the <code>vitalperiodic</code> and <code>vitalaperiodic</code> tables in eICU are layed out in <em>wide</em> format (whereas most other tables are in <em>long</em> format), and therefore no unit columns are available. This also explains the substantial degree of missingness (in terms of values) reported, as such a <em>wide</em> data organization scheme coupled with differing measurement intervals per variable will inevitably lead to some degree of sparsity.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

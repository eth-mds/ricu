<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Units of measurement • ICU data with R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Units of measurement">
<meta property="og:description" content="ricu">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ICU data with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ricu.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jss.pdf">ricu: R's Interface to Intensive Care Data (PDF)</a>
    </li>
    <li>
      <a href="../articles/uom.html">Units of measurement</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eth-mds/ricu">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="uom_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Units of measurement</h1>
            
      
      
      <div class="hidden name"><code>uom.Rmd</code></div>

    </div>

    
    
<p>One challenge when working with electronic healthcare (EHR) data from different hospitals, which is accentuated if the intensive care units (ICUs) collecting the data are located in different geographic regions, is the use of different measurement unit systems. In part, this can be attributed to the use of imperial units in English speaking countries (e.g. patient weight being reported in lbs instead of kg), but more subtle differences in practice are involved as well, such as reporting lab test results in mg/dL instead of the SI unit mmol/L. While discrepancies of the former type are easy to resolve, harmonization of different notions of concentration is slightly more involved due to the conversion factor being substance-specific.</p>
<div id="ricu-data-concepts" class="section level2">
<h2 class="hasAnchor">
<a href="#ricu-data-concepts" class="anchor"></a><code>ricu</code> data concepts</h2>
<p>Data concepts of type <code>num_cncpt</code> can specify an expected units as character vector (where the string in position 1 is added as per-column attribute <code>units</code>). When using concepts of this type, unit conversion to the specified target unit is not handled automatically but is up to the user via a callback function. Unit mismatches are reported as messages during concept loading<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">assign_dataset_names</span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></code></pre></div>
<p>[1] “<code>{r, assign-demo, eval = FALSE}\ndemo &lt;- c(\"mimic_demo\", \"eicu_demo\")\n</code>”</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_concepts.html">load_concepts</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lact"</span>, <span class="st">"map"</span><span class="op">)</span>, <span class="va">demo</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; ── Loading 2 concepts ──────────────────────────────────────────────────────────</span>
<span class="co">#&gt; • lact</span>
<span class="co">#&gt;   ◯ removed 19 (0.74%) of rows due to out of range (or `NA`) entries</span>
<span class="co">#&gt;   ◯ not all units are in [mmol/L]: mEq/L, mmole/L, MMOLL (0.62%, 0.08%,</span>
<span class="co">#&gt;     and 0.51%)</span>
<span class="co">#&gt; • map</span>
<span class="co">#&gt;   ◯ removed 1438014 (74.7%) of rows due to out of range (or `NA`)</span>
<span class="co">#&gt;     entries</span>
<span class="co">#&gt;   ◯ not all units are in [mmHg], [mm Hg]: NA (96.74%)</span>
<span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; # A `ts_tbl`: 139,144 ✖ 5</span>
<span class="co">#&gt; # Id vars:    `source`, `icustay_id`</span>
<span class="co">#&gt; # Units:      `lact` [mmol/L], `map` [mmHg]</span>
<span class="co">#&gt; # Index var:  `charttime` (1 hours)</span>
<span class="co">#&gt;         source     icustay_id charttime  lact   map</span>
<span class="co">#&gt;         &lt;chr&gt;           &lt;int&gt; &lt;drtn&gt;    &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;       1 eicu_demo      141764   1 hours    NA  112.</span>
<span class="co">#&gt;       2 eicu_demo      141764   2 hours    NA  128</span>
<span class="co">#&gt;       3 eicu_demo      141764   3 hours    NA  143</span>
<span class="co">#&gt;       4 eicu_demo      141764   4 hours    NA  133</span>
<span class="co">#&gt;       5 eicu_demo      141764   5 hours    NA  103</span>
<span class="co">#&gt;       …</span>
<span class="co">#&gt; 139,140 mimic_demo     298685 314 hours    NA   76</span>
<span class="co">#&gt; 139,141 mimic_demo     298685 315 hours    NA   58</span>
<span class="co">#&gt; 139,142 mimic_demo     298685 316 hours    NA   47</span>
<span class="co">#&gt; 139,143 mimic_demo     298685 317 hours    NA   35</span>
<span class="co">#&gt; 139,144 mimic_demo     298685 318 hours    NA   12</span>
<span class="co">#&gt; # … with 139,134 more rows</span></code></pre></div>
<p>Messages raised during loading of lactate values, for example, indicate that 0.62% of retrieved values are specified in mEq/L instead of mmol/L (which requires an identity transformation for unit conversion), while the remaining discrepancies are false positives (both mmole/L and MMOLL can be assumed to mean mmol/L). For mean arterial bloop pressure values, the target unit is specified as mmHg (with the alternative spelling mm Hg being accepted as well), however, due to the data organization in eICU<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, no explicit measurement units are specified for this variable, in turn causing the large percentage of missing unit values reported.</p>
<p>Several utility functions are exported from <code>ricu</code> for helping with creating callback functions that handle unit conversion. Data items corresponding to the bilirubin concept for the European datasets HiRID and AUMCdb, for example, have a callback entry specified as <code><a href="../reference/transform_fun.html">convert_unit(binary_op(`*`, 0.058467), "mg/dL")</a></code>. This creates a callback functions which applies <code><a href="../reference/transform_fun.html">binary_op(`*`, 0.058467)</a></code> to the column specified as <code>val_var</code> and replaces existing values in the column identified by <code>unit_var</code> with the value <code>"mg/dl"</code>. In case the loaded data already is comprised of a mix of units, a regular expression passed as <code>rgx</code> can be specified, which will be used to identify the rows on which to operate. Finally, the function <code>binary_op</code> turns a binary function into an unary function by fixing the second operand.</p>
<p>As a first sanity check we will slightly modify data loading in order to be warned about item IDs that do not appear in the data. For this we chop up data items loaded from the dictionary such that items of type <code>sel_itm</code> which may contain several IDs, are split into separate items and regular expressions in <code>rgx_itm</code> items are taken apart such that aggregate expressions such as <code>(foo|bar)baz</code> are turned into <code>foobaz</code> and <code>barbaz</code>.</p>
<p>Next, for the actual data loading, <code>report_empty()</code> substitutes the internally called function <code><a href="../reference/prepare_query.html">do_itm_load()</a></code> with a modified version that takes note of the offending IDs alongside concept, table and data source names whenever zero rows are returned for a given <code>itm</code> object.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">concepts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"lact"</span>, <span class="st">"bili"</span>, <span class="st">"gcs"</span>, <span class="st">"abx"</span><span class="op">)</span>

<span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_dictionary.html">load_dictionary</a></span><span class="op">(</span><span class="va">demo</span>, <span class="va">concepts</span><span class="op">)</span>

<span class="va">empty_items</span> <span class="op">&lt;-</span> <span class="fu">report_empty</span><span class="op">(</span><span class="va">dict</span>, merge <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Tracing function "do_itm_load" in package "ricu"</span>
<span class="co">#&gt; Untracing function "do_itm_load" in package "ricu"</span></code></pre></div>
<table class="table">
<caption>For the given concepts, the listed item IDs do not return any data when the respective tables and data sources are queried.</caption>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">id</th>
<th align="left">source</th>
<th align="left">table</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">map</td>
<td align="left">6072</td>
<td align="left">mimic_demo</td>
<td align="left">chartevents</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">aztreonam</td>
<td align="left">mimic_demo</td>
<td align="left">prescriptions</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225838</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225840</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225844</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225847</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225848</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225857</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225862</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225866</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225868</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225871</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225873</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225875</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225876</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225877</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225882</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225885</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225886</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225889</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225890</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225895</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225896</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225897</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225898</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225900</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">225903</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">225905</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="odd">
<td align="left">abx</td>
<td align="left">228003</td>
<td align="left">mimic_demo</td>
<td align="left">inputevents_mv</td>
</tr>
<tr class="even">
<td align="left">abx</td>
<td align="left">bactrim</td>
<td align="left">eicu_demo</td>
<td align="left">infusiondrug</td>
</tr>
</tbody>
</table>
<p>If no table is printed given the modified data loading above, every single ID that is part of a <code>sel_itm</code> or an <code>rgx_itm</code> actually returns some data. For other types of data items this means that for every single item as a whole, some data was returned. There are limitations to this type of sanity check though: It might be the case that one of the supplied IDs associated with a <code>num_cncpt</code> concept returns data in an unexpected unit of measurement which may cause the range filter to remove all of that data again. In such a scenario though, this will be reported (if <code>TRUE</code> is passed as <code>verbose</code> argument to <code>load_concept()</code>). Paying attention to the output produced by <code>load_concept()</code> should help spot such issues, albeit no longer at item resolution but only at concept level.</p>
<p>Next, we will investigate the number of measurements available per concept and stay day. For each stay ID and concept we calculate the number of measurements and note the stay duration. From this we can visualize how the number of measurements per day is distributed over the datasets alongside the percentage of patients that have at least one measurement available.</p>
<p>[1] “&gt; Note: The following code blocks are run using demo (<code>mimic_demo</code> and <code>eicu_demo</code>, ) instead of full datasets (<code>mimic</code>, <code>eicu</code>, <code>aumc</code>, <code>hirid</code> and <code>miiv</code>, ) and therefore might be less useful. For data set up, please consult the manual at <code><a href="../reference/attach_src.html">?attach_src</a></code>. The full version of this vignette is available from <a href="https://CRAN.R-project.org/package=ricu/vignettes/uom.html">CRAN</a>.”</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_meas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="../reference/id_vars.html">data_var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>count <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/id_vars.html">id_vars</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">meas_day</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">los</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">los</span><span class="op">)</span><span class="op">[</span>, <span class="va">count</span> <span class="op">:=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">los_icu</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">quants</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"lwr"</span>, <span class="st">"med"</span>, <span class="st">"upr"</span>, <span class="st">"max"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">meas_stats</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">concept</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>concept <span class="op">=</span> <span class="va">concept</span>, n_pat <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, <span class="fu">quants</span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="va">los_icu</span><span class="op">)</span><span class="op">)</span>,
    by <span class="op">=</span> <span class="st">"source"</span><span class="op">]</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">assign_dataset_names</span><span class="op">(</span><span class="va">srcs</span><span class="op">)</span></code></pre></div>
<p>[1] “<code>{r, assign-srcs, eval = FALSE}\nsrcs &lt;- c(\"mimic_demo\", \"eicu_demo\")\n</code>”</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">count_meas</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="fu"><a href="../reference/id_vars.html">data_var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>count <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/id_vars.html">id_vars</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">meas_day</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">los</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">los</span><span class="op">)</span><span class="op">[</span>, <span class="va">count</span> <span class="op">:=</span> <span class="va">count</span> <span class="op">/</span> <span class="va">los_icu</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">quants</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"lwr"</span>, <span class="st">"med"</span>, <span class="st">"upr"</span>, <span class="st">"max"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">meas_stats</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">concept</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>concept <span class="op">=</span> <span class="va">concept</span>, n_pat <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, <span class="fu">quants</span><span class="op">(</span><span class="va">count</span> <span class="op">/</span> <span class="va">los_icu</span><span class="op">)</span><span class="op">)</span>,
    by <span class="op">=</span> <span class="st">"source"</span><span class="op">]</span>
<span class="op">}</span>

<span class="va">los</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_concepts.html">load_concepts</a></span><span class="op">(</span><span class="st">"los_icu"</span>, <span class="va">srcs</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">los</span> <span class="op">&lt;-</span> <span class="va">los</span><span class="op">[</span><span class="va">los_icu</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span>

<span class="va">concepts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"map"</span>, <span class="st">"lact"</span>, <span class="st">"crea"</span>, <span class="st">"bili"</span>, <span class="st">"plt"</span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_concepts.html">load_concepts</a></span><span class="op">(</span><span class="va">concepts</span>, <span class="va">srcs</span>, merge <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">count_meas</span><span class="op">)</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">counts</span>, <span class="va">merge</span>, <span class="va">los</span><span class="op">)</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Map</a></span><span class="op">(</span><span class="va">meas_stats</span>, <span class="va">counts</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span><span class="op">)</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">counts</span><span class="op">)</span>
<span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">counts</span>, <span class="va">los</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>total_pat <span class="op">=</span> <span class="va">.N</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"source"</span><span class="op">]</span>,
                by <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span>
<span class="co">#&gt;        source concept n_pat        min        lwr        med       upr</span>
<span class="co">#&gt; 1:  eicu_demo     map  2343  8.1547749 18.7905901 22.5195482 23.737428</span>
<span class="co">#&gt; 2:  eicu_demo    lact   838  0.1607749  0.4263825  0.9270397  1.868192</span>
<span class="co">#&gt; 3:  eicu_demo    crea  2368  0.8504940  1.4980497  2.5036223  4.643951</span>
<span class="co">#&gt; 4:  eicu_demo    bili  1823  0.2477931  0.6470456  1.2080537  2.244740</span>
<span class="co">#&gt; 5:  eicu_demo     plt  2306  0.7593835  1.3696041  2.2102853  4.093090</span>
<span class="co">#&gt; 6: mimic_demo     map   132 14.8758279 19.7455626 21.5032468 22.526516</span>
<span class="co">#&gt;          max total_pat</span>
<span class="co">#&gt; 1: 24.959050      2508</span>
<span class="co">#&gt; 2:  6.116601      2508</span>
<span class="co">#&gt; 3: 16.187792      2508</span>
<span class="co">#&gt; 4:  8.122924      2508</span>
<span class="co">#&gt; 5: 14.514992      2508</span>
<span class="co">#&gt; 6: 23.453204       136</span></code></pre></div>
<p><img src="uom_files/figure-html/count-plot-1.png" width="576"></p>
<p>Finally, we compare the densities we obtain by looking concept values per dataset, as visualized in the following plot.</p>
<p><img src="uom_files/figure-html/uom-hist-1.png" width="576"><img src="uom_files/figure-html/uom-hist-2.png" width="576"><img src="uom_files/figure-html/uom-hist-3.png" width="576"><img src="uom_files/figure-html/uom-hist-4.png" width="576"><img src="uom_files/figure-html/uom-hist-5.png" width="576"></p>
<p>When extending the <code>ricu</code> dictionary to both new data sources and new data concepts, it might be worthwhile to visually inspect the returned data in a fashion similar to the above in order to have a high-level confirmation that measurement units roughly agree.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Recently, experimental support for automatic unit conversion has been added via the <code>unt_cncpt</code> class. Such a concept will attempt to convert data columns using the <a href="https://cran.r-project.org/package=units">units</a> package and therefore requires that both the source- and target-units are recognized and convertible (see <code><a href="https://rdrr.io/pkg/units/man/ud_are_convertible.html">units::ud_are_convertible()</a></code>).<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Both the <code>vitalperiodic</code> and <code>vitalaperiodic</code> tables in eICU are layed out in <em>wide</em> format (whereas most other tables are in <em>long</em> format), and therefore no unit columns are available. This also explains the substantial degree of missingness (in terms of values) reported, as such a <em>wide</em> data organization scheme coupled with differing measurement intervals per variable will inevitably lead to some degree of sparsity.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicolas Bennett, Drago Plecko, Ida-Fong Ukor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
